# ğŸµ Spotify ë°ì´í„° ë¶„ì„: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì • ë° ëª©ì 

## 1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸ (Import Libraries)

ë°ì´í„° ì „ì²˜ë¦¬, ì‹œê°í™”, ê·¸ë¦¬ê³  **ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ì˜ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜** êµ¬í˜„ì„ ìœ„í•´ í•„ìš”í•œ í•µì‹¬ ë„êµ¬ë“¤ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.

from scipy.spatial import distance 
ê±°ë¦¬ê³„ì‚° ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œì§€

## ğŸ“‚ 2. ë°ì´í„° ë¡œë“œ ë° í™•ì¸ (Data Loading)

### 2-1. íŒŒì¼ ê²½ë¡œ íƒìƒ‰ (File Discovery)
ìºê¸€ì˜ ì¸í’‹ ë””ë ‰í† ë¦¬(`/kaggle/input`)ì— ì–´ë–¤ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ì •í™•í•œ ê²½ë¡œë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.

import os íŒŒì¼ê²½ë¡œ íƒìƒ‰

# ìºê¸€ ì…ë ¥ í´ë” ë‚´ì˜ ëª¨ë“  íŒŒì¼ ê²½ë¡œ ì¶œë ¥
for dirname, _, filenames in os.walk('/kaggle/input'):
    for filename in filenames:
        print(os.path.join(dirname, filename))

# ë°ì´í„° ë¡œë“œ
# index_col=0: CSV íŒŒì¼ì˜ ì²« ë²ˆì§¸ ì—´(0ë²ˆ)ì„ ì¸ë±ìŠ¤ë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
# (ì´ ì˜µì…˜ì´ ì—†ìœ¼ë©´ 'Unnamed: 0' ê°™ì€ ë¶ˆí•„ìš”í•œ ì¸ë±ìŠ¤ ì»¬ëŸ¼ì´ ìƒê¸¸ ìˆ˜ ìˆìŒ)
df = pd.read_csv('/kaggle/input/-spotify-tracks-dataset/dataset.csv', index_col=0)

# ë°ì´í„° ìƒ˜í”Œ í™•ì¸ (Random Sampling)
# head() ëŒ€ì‹  sample()ì„ ì“°ë©´ ë°ì´í„°ê°€ ë¬´ì‘ìœ„ë¡œ ì˜ ì„ì—¬ìˆëŠ”ì§€ í™•ì¸í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.
df.sample(5)

## ğŸ§¹ 3. ë°ì´í„° êµ¬ì¡° í™•ì¸ ë° ì¤‘ë³µ ì œê±° (Structure Check & Duplicate Removal)

ë°ì´í„°ì˜ ì „ì²´ ê·œëª¨(Shape)ë¥¼ íŒŒì•…í•˜ê³ , ë¶„ì„ ê²°ê³¼ì— ì™œê³¡ì„ ì¤„ ìˆ˜ ìˆëŠ” ì¤‘ë³µ ë°ì´í„°(Duplicate Rows)ë¥¼ ì‚¬ì „ì— ì œê±°í•˜ì—¬ ë°ì´í„°ì˜ í’ˆì§ˆì„ í™•ë³´í•©ë‹ˆë‹¤.

# 1. ë°ì´í„° í”„ë ˆì„ì˜ í¬ê¸°(Shape) í™•ì¸
rows, cols = df.shape

# 2. ì¤‘ë³µ ë°ì´í„° í™•ì¸ ë° ì œê±°
duplicated_rows = df.duplicated().sum()

if duplicated_rows == 0:
else:
    # ì¤‘ë³µ ì œê±° ìˆ˜í–‰
    df = df.drop_duplicates()

## ğŸ•µï¸ 4. ë°ì´í„° íƒ€ì… ì‹¬ì¸µ ë¶„ì„ ë° í–‰(Row)ë³„ ê²°ì¸¡ì¹˜ ì§„ë‹¨

ë°ì´í„°ì˜ ìë£Œí˜•(Data Type)ì„ ê¼¼ê¼¼í•˜ê²Œ í™•ì¸í•˜ê³ , íŠ¹ì • ë°ì´í„°(í–‰)ì— ê²°ì¸¡ì¹˜ê°€ ì§‘ì¤‘ë˜ì–´ ìˆëŠ”ì§€ íŒŒì•…í•˜ì—¬ ë°ì´í„°ì˜ í’ˆì§ˆì„ í‰ê°€í•©ë‹ˆë‹¤.

### 4-1. ë°ì´í„° íƒ€ì… ìƒì„¸ í™•ì¸ (Deep Dive into Data Types)
íŒë‹¤ìŠ¤ì—ì„œ `object` íƒ€ì…ì€ ë³´í†µ ë¬¸ìì—´ì„ ì˜ë¯¸í•˜ì§€ë§Œ, ê°€ë” ìˆ«ìë‚˜ ë¦¬ìŠ¤íŠ¸ ë“± ë‹¤ë¥¸ íƒ€ì…ì´ ì„ì—¬ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í™•ì‹¤í•˜ê²Œ ê²€ì¦í•˜ê¸° ìœ„í•´ ë‚´ë¶€ì˜ ì‹¤ì œ íƒ€ì…ì„ í™•ì¸í•©ë‹ˆë‹¤.

# 1. ê¸°ë³¸ ë°ì´í„° íƒ€ì… í™•ì¸
# íŒë‹¤ìŠ¤ê°€ ì¸ì‹í•˜ê³  ìˆëŠ” ê° ì»¬ëŸ¼ì˜ ìë£Œí˜•ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
display(df.dtypes.to_frame('Data Type'))

# 2. Object íƒ€ì… ì»¬ëŸ¼ì˜ ì‹¤ì œ ë‚´ë¶€ ìë£Œí˜• í™•ì¸ (Custom Function)
def open_object_dtype(s):
    """
    ì»¬ëŸ¼(Series) ë‚´ì— ë“¤ì–´ìˆëŠ” ê°’ë“¤ì˜ ì‹¤ì œ ìë£Œí˜•(type)ì„ ì§‘í•©(set)ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
    ì˜ˆ: {str}, {str, int} ë“±
    """
    dtypes = set()
    dtypes.update(s.apply(type))
    return dtypes

# Object íƒ€ì…ì¸ ì»¬ëŸ¼ë§Œ ê³¨ë¼ë‚´ê¸°
obj_cols = df.select_dtypes(include='object').columns

# ê° Object ì»¬ëŸ¼ ë‚´ë¶€ì— ì–´ë–¤ íŒŒì´ì¬ íƒ€ì…ë“¤ì´ ë“¤ì–´ìˆëŠ”ì§€ í™•ì¸
display(df[obj_cols].apply(open_object_dtype, axis=0).to_frame('Data Type'))

# 1. ê° í–‰ë³„ë¡œ ê²°ì¸¡ì¹˜ ê°œìˆ˜ ì„¸ê¸° (axis=1)
missing_values_per_row = df.isnull().sum(axis=1)

# 2. ê²°ì¸¡ì¹˜ ê°œìˆ˜ë³„ í–‰ì˜ ë¹ˆë„ìˆ˜ ê³„ì‚°
# ì˜ˆ: ê²°ì¸¡ì¹˜ê°€ 0ê°œì¸ í–‰ì€ 1000ê°œ, 1ê°œì¸ í–‰ì€ 5ê°œ...
count_per_missing_value = missing_values_per_row.value_counts().sort_index()

# 3. ê²°ê³¼ ì¶œë ¥
# 4. ê²°ì¸¡ì¹˜ê°€ í•˜ë‚˜ë¼ë„ ìˆëŠ” í–‰ì˜ ì´ ê°œìˆ˜
total_rows_with_missing_values = (df.isnull().any(axis=1)).sum()
print(f'\nTotal number of rows with missing values: {total_rows_with_missing_values}')

## ğŸ“Š 5. ìˆ˜ì¹˜í˜• ë°ì´í„° ë¶„í¬ ë° ê²°ì¸¡ì¹˜ ì •ë°€ ë¶„ì„ (Numerical Data Distribution)

ë°ì´í„°ì…‹ì—ì„œ ìˆ«ì(Float, Int)ë¡œ ëœ ì»¬ëŸ¼ë§Œ ë”°ë¡œ ë½‘ì•„ë‚´ì–´, ê°’ì˜ **ìµœì†Œ/ìµœëŒ€ ë²”ìœ„**ë¥¼ í™•ì¸í•˜ê³  **ìˆ¨ê²¨ì§„ ê²°ì¸¡ì¹˜**ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.

### 5-1. ìˆ˜ì¹˜í˜• ì»¬ëŸ¼ ì¶”ì¶œ (Extract Numerical Columns)
ë¶„ì„ê³¼ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ í•™ìŠµì— ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìˆ«ì ë°ì´í„°ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.

# 1. ìˆ˜ì¹˜í˜•(float, int) ì»¬ëŸ¼ë§Œ í•„í„°ë§
# (select_dtypes(include='number')ì™€ ê°™ì€ ì—­í• ì„ í•˜ëŠ” ìˆ˜ë™ ì½”ë“œ)
numerical_cols = df[df.columns[(df.dtypes == 'float64') | (df.dtypes == 'int64')]]

# 2. ë°ì´í„° í¬ê¸° ë° ìƒ˜í”Œ í™•ì¸
# 1. ê¸°ì´ˆ í†µê³„ëŸ‰ì—ì„œ ìµœì†Œ(min), ìµœëŒ€(max) ê°’ë§Œ ì¶”ì¶œí•˜ì—¬ ì „ì¹˜(Transpose)
# .Të¥¼ í•˜ë©´ í–‰ê³¼ ì—´ì´ ë’¤ë°”ë€Œì–´ ë³´ê¸°ì— í¸í•´ì§‘ë‹ˆë‹¤.
dist_numerical_cols = numerical_cols.describe().T[['min', 'max']]

# 2. ê²°ì¸¡ì¹˜ ê°œìˆ˜(Count) ì»¬ëŸ¼ ì¶”ê°€
dist_numerical_cols['Missing Values'] = numerical_cols.isnull().sum()

# 3. ê²°ì¸¡ì¹˜ ë¹„ìœ¨(Percentage) ì»¬ëŸ¼ ì¶”ê°€
dist_numerical_cols['Missing Percentage'] = (numerical_cols.isnull().mean() * 100).round(2)

# 4. 'key' ì»¬ëŸ¼ì˜ ìˆ¨ê²¨ì§„ ê²°ì¸¡ì¹˜(-1) ì²˜ë¦¬ âœ¨
# Spotifyì—ì„œ Keyê°€ -1ì¸ ê²½ìš°ëŠ” "ì¡°(Key)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"ì„ ì˜ë¯¸í•˜ë¯€ë¡œ,
# ì´ë¥¼ ë‹¨ìˆœ ìˆ«ìê°€ ì•„ë‹Œ 'ê²°ì¸¡ì¹˜'ë¡œ ê°„ì£¼í•˜ì—¬ ì¹´ìš´íŠ¸í•©ë‹ˆë‹¤.
dist_numerical_cols.loc['key', 'Missing Values'] = (df['key'] == -1).sum()

# ìµœì¢… ìš”ì•½í‘œ ì¶œë ¥

## ğŸ¨ 6. ìˆ˜ì¹˜í˜• ë°ì´í„° ì‹œê°í™” ë° ë²”ì£¼í˜• ë°ì´í„° ë¶„ì„

ìˆ˜ì¹˜í˜• ë°ì´í„°ë“¤ì´ ì–´ë–»ê²Œ ë¶„í¬í•´ ìˆëŠ”ì§€ íˆìŠ¤í† ê·¸ë¨ìœ¼ë¡œ í•œëˆˆì— íŒŒì•…í•˜ê³ , ì´ì œ ë¶„ì„ ëŒ€ìƒì„ í…ìŠ¤íŠ¸(Object)ë‚˜ ì°¸/ê±°ì§“(Bool) í˜•íƒœì˜ **ë²”ì£¼í˜• ë°ì´í„°**ë¡œ ì „í™˜í•©ë‹ˆë‹¤.

### 6-1. ìˆ˜ì¹˜í˜• ë°ì´í„° ë¶„í¬ ì‹œê°í™” (Histogram Visualization)
í†µê³„ëŸ‰(`describe`)ë§Œìœ¼ë¡œëŠ” ë°ì´í„°ì˜ **ì¹˜ìš°ì¹¨(Skewness)**ì´ë‚˜ **íŒ¨í„´**ì„ ì•Œê¸° ì–´ë µìŠµë‹ˆë‹¤. íˆìŠ¤í† ê·¸ë¨ì„ ê·¸ë ¤ ë°ì´í„°ì˜ ëª¨ì–‘ì„ ì§ì ‘ í™•ì¸í•©ë‹ˆë‹¤.

# 1. ê¸°ì´ˆ í†µê³„ëŸ‰ ì¬í™•ì¸
# 3. ì „ì²´ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ íˆìŠ¤í† ê·¸ë¨ ì¶œë ¥
plt.tight_layout() # ê·¸ë˜í”„ ê°„ ê°„ê²© ìë™ ì¡°ì ˆ
# 1. ë²”ì£¼í˜•(Object) ë° ë¶ˆë¦¬ì–¸(Bool) ì»¬ëŸ¼ë§Œ í•„í„°ë§
# explicit(19ê¸ˆ ì—¬ë¶€)ëŠ” bool íƒ€ì…ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•¨ê»˜ í¬í•¨í•©ë‹ˆë‹¤.
categorical_cols = df[df.columns[(df.dtypes == 'object') | (df.dtypes == 'bool')]]

# 2. ë°ì´í„° í¬ê¸° ë° ìƒ˜í”Œ í™•ì¸
# 3. ë°ì´í„° ì •ë³´ í™•ì¸
# ê²°ì¸¡ì¹˜ ê°œìˆ˜ì™€ ë¹„ìœ¨ì„ ë³´ì—¬ì£¼ëŠ” ìš”ì•½ ë°ì´í„°í”„ë ˆì„ ìƒì„±
dist_categorical_cols = pd.DataFrame(
    data = {
        'Missing Values': categorical_cols.isnull().sum(),
        'Missing Percentage': (categorical_cols.isnull().mean() * 100)
    }
)

# ê²°ê³¼ ì¶œë ¥
## ğŸ§¹ 7. ë²”ì£¼í˜• ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ë° 19ê¸ˆ(Explicit) ë¹„ìœ¨ ë¶„ì„

ë²”ì£¼í˜• ë°ì´í„°(ë…¸ë˜ ì œëª©, ì•„í‹°ìŠ¤íŠ¸ ë“±)ì— ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ì„ ì œê±°í•˜ì—¬ ë°ì´í„°ë¥¼ ì •ì œí•˜ê³ , `Explicit`(ì²­ë¶ˆ) íŠ¸ë™ì˜ ë¹„ìœ¨ì„ íŒŒì´ ì°¨íŠ¸ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.
### 7-1. ê²°ì¸¡ì¹˜ ì œê±° (Dropping Missing Values)
ë…¸ë˜ ì œëª©ì´ë‚˜ ì•„í‹°ìŠ¤íŠ¸ ì •ë³´ê°€ ì—†ëŠ” ë°ì´í„°ëŠ” ë¶„ì„ì— ë¬´ì˜ë¯¸í•˜ë¯€ë¡œ ì œê±°í•©ë‹ˆë‹¤.
# 1. ê²°ì¸¡ì¹˜ê°€ í¬í•¨ëœ ë²”ì£¼í˜• ë°ì´í„° í™•ì¸
display(categorical_cols[categorical_cols.isnull().any(axis=1)])

# 2. ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰(Index) ì¶”ì¶œ
index_to_drop = df[categorical_cols.isnull().any(axis=1)].index
# 4. ì²˜ë¦¬ ê²°ê³¼ í™•ì¸
# include=['object', 'bool'] ì˜µì…˜ìœ¼ë¡œ ë¬¸ìì—´ê³¼ ë¶ˆë¦¬ì–¸ íƒ€ì…ì˜ í†µê³„ëŸ‰ë§Œ ë´…ë‹ˆë‹¤.
df.describe(include=['object', 'bool'])

# 1. ê°’ì˜ ë¹ˆë„ìˆ˜ ê³„ì‚° (True/False ê°œìˆ˜ ì„¸ê¸°)
# 2. íŒŒì´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
fig, ax = plt.subplots(figsize=(5, 5))

# ê°•ì¡° íš¨ê³¼ (Explode): 'True'ì— í•´ë‹¹í•˜ëŠ” ì¡°ê°ì„ ì‚´ì§ ë–¼ì–´ë‚´ì–´ ê°•ì¡°í•¨
# [0, 0.1] -> ì²« ë²ˆì§¸ ì¡°ê°(False)ì€ ê·¸ëŒ€ë¡œ, ë‘ ë²ˆì§¸ ì¡°ê°(True)ì€ 0.1ë§Œí¼ ë°–ìœ¼ë¡œ ëºŒ
explode = [0, 0.1]  

ax.pie(value_counts, labels=unique_values, autopct='%1.2f%%', 
       startangle=90, colors=colors, explode=explode, shadow=True)

ax.axis('equal') # ì›ì´ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šê³  ì •ì›ìœ¼ë¡œ ë³´ì´ê²Œ ì„¤ì •

## ğŸ† 8. ìƒìœ„ 10ê°œ í•­ëª© ë¶„ì„ (Top 10 Analysis)

ê°€ì¥ ë§ì´ ë“±ì¥í•œ ì•„í‹°ìŠ¤íŠ¸, ì•¨ë²”, íŠ¸ë™, ì¥ë¥´ê°€ ë¬´ì—‡ì¸ì§€ `value_counts()`ë¡œ ì§‘ê³„í•˜ê³ , ì´ë¥¼ **2x2 ì„œë¸Œí”Œë¡¯(Subplots)**ì„ í†µí•´ í•œ í™”ë©´ì— ì‹œê°í™”í•©ë‹ˆë‹¤.

### 8-1. ë°ì´í„° ì§‘ê³„ (Frequency Counting)
ê° ì»¬ëŸ¼ì—ì„œ ê°€ì¥ ìì£¼ ë“±ì¥í•˜ëŠ” ìƒìœ„ 10ê°œ(Top N) ë°ì´í„°ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
top_n = 10

# 1. ë¹ˆë„ìˆ˜ ê¸°ì¤€ ìƒìœ„ 10ê°œ ì¶”ì¶œ
# value_counts(): ê³ ìœ ê°’ì˜ ê°œìˆ˜ë¥¼ ì„¸ì–´ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
# FutureWarning ë¬´ì‹œ (ë²„ì „ ì°¨ì´ë¡œ ì¸í•œ ë¶ˆí•„ìš”í•œ ê²½ê³  ìˆ¨ê¹€)
with warnings.catch_warnings():
    warnings.simplefilter("ignore", category=FutureWarning)
    # zorder=0: ê·¸ë¦¬ë“œ ì„ ì„ ë§‰ëŒ€ ë’¤ë¡œ ë³´ëƒ„ (ê·¸ë˜í”„ê°€ ë” ê¹”ë”í•´ì§)
    alpha íˆ¬ëª…ë„
    orient='h ë§‰ëŒ€ê·¸ë˜í”„ ê°€ë¡œë¡œ ëˆ•íˆê¸°
    # ë ˆì´ì•„ì›ƒ ìë™ ì¡°ì • (ê¸€ì ê²¹ì¹¨ ë°©ì§€)
    plt.tight_layout()

## ğŸ“‰ 9. ì´ìƒì¹˜ íƒì§€ ë° ìƒê´€ê´€ê³„ ì‹¬ì¸µ ë¶„ì„

ë°ì´í„°ì˜ ë¶„í¬ë¥¼ ë°•ìŠ¤í”Œë¡¯(Boxplot)ìœ¼ë¡œ ê·¸ë ¤ **íŠ€ëŠ” ê°’(Outlier)**ì„ ì°¾ì•„ë‚´ê³ , ë³€ìˆ˜ë“¤ë¼ë¦¬ ì„œë¡œ ì–´ë–¤ ê´€ê³„ê°€ ìˆëŠ”ì§€ **ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ**ìœ¼ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.

### 9-1. ë°•ìŠ¤í”Œë¡¯ì„ ì´ìš©í•œ ì´ìƒì¹˜ íƒì§€ (Outlier Detection)
`Tempo`, `Duration`, `Popularity` ë“± ì£¼ìš” ìˆ˜ì¹˜í˜• ë°ì´í„°ì— ìœ ë… íŠ€ëŠ” ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

# 2. ë¶„ì„í•  ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸ ì •ì˜ (11ê°œ)
# 3. 3í–‰ 4ì—´(ì´ 12ê°œ ê³µê°„)ì˜ ì„œë¸Œí”Œë¡¯ ìƒì„±
fig, axes = plt.subplots(nrows=3, ncols=4, figsize=(15, 10))

# 4. ë°˜ë³µë¬¸ìœ¼ë¡œ ë°•ìŠ¤í”Œë¡¯ ê·¸ë¦¬ê¸°
for i, col in enumerate(columns):
    # i//4: í–‰ ì¸ë±ìŠ¤ (0, 0, 0, 0, 1...)
    # i%4: ì—´ ì¸ë±ìŠ¤ (0, 1, 2, 3, 0...)
    sns.boxplot(y=col, data=numerical_cols, ax=axes[i//4, i%4])
    axes[i//4, i%4].set_title(col)


# 1. ìƒê´€ê³„ìˆ˜ í–‰ë ¬ ê³„ì‚°
corr = numerical_cols.corr()

# 2. ë§ˆìŠ¤í¬ ìƒì„± (ìœ„ìª½ ì‚¼ê°í˜• ê°€ë¦¬ê¸°)
# np.triu_indices_from: í–‰ë ¬ì˜ ìœ„ìª½ ì‚¼ê°í˜• ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜
mask = np.zeros_like(corr)
mask[np.triu_indices_from(mask)] = True
# 3. íˆíŠ¸ë§µ ìŠ¤íƒ€ì¼ ì„¤ì •
# 4. íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
# mask=mask: ìœ„ì—ì„œ ë§Œë“  ë§ˆìŠ¤í¬ ì ìš©
# annot=True: ì¹¸ ì•ˆì— ìˆ˜ì¹˜ í‘œì‹œ
# cmap='coolwarm': íŒŒë€ìƒ‰(ìŒ) ~ ë¹¨ê°„ìƒ‰(ì–‘)
# vmin, max ìƒ‰ìƒê¸°ì¤€ ê³ ì •
sns.heatmap(corr, mask=mask, annot=True, vmin=-1, vmax=1, cmap='coolwarm')

## ğŸ¸ 10. ì¥ë¥´ë³„ ì‹¬ì¸µ ë¶„ì„ (Genre Analysis)

ì¥ë¥´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ **"ê°€ì¥ ê³¡ì´ ë§ì€ ì¥ë¥´"**, **"ê°€ì¥ ì¸ê¸°ê°€ ë§ì€ ì¥ë¥´"**, **"ê°€ì¥ ì„ ì •ì ì¸(Explicit) ì¥ë¥´"** Top 10ì„ ë½‘ì•„ ë¹„êµí•©ë‹ˆë‹¤.

### 10-1. ê³¡ ìˆ˜ ê¸°ì¤€ Top 10 ì¥ë¥´ (Most Frequent Genres)
ë°ì´í„°ì…‹ì— ì–´ë–¤ ì¥ë¥´ì˜ ë…¸ë˜ê°€ ê°€ì¥ ë§ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

# 1. ì¥ë¥´ë³„ ê³¡ ìˆ˜ ê³„ì‚°
# 2. ê°€ë¡œ ë§‰ëŒ€ê·¸ë˜í”„ ì‹œê°í™”
plt.gca().invert_yaxis() # ìƒìœ„ í•­ëª©ì´ ìœ„ë¡œ ì˜¤ë„ë¡ Yì¶• ë°˜ì „
# 1. ì¥ë¥´ë³„ ì¸ê¸° ì ìˆ˜ í‰ê·  ê³„ì‚°
avg_popularity_by_genre = df.groupby('track_genre')['popularity'].mean().reset_index()

# 2. í‰ê·  ì¸ê¸°ê°€ ê°€ì¥ ë†’ì€ 10ê°œ ì¥ë¥´ ì¶”ì¶œ
top10_popular_genres = avg_popularity_by_genre.nlargest(10, 'popularity')
# 1. ì¥ë¥´ë³„ Explicit ë¹„ìœ¨ ê³„ì‚° (True=1, False=0 ì´ë¯€ë¡œ í‰ê· ì´ ê³§ ë¹„ìœ¨ì´ ë¨)
explicit_ratio_by_genre = df.groupby('track_genre')['explicit'].mean().reset_index()

# 2. Explicit ë¹„ìœ¨ì´ ê°€ì¥ ë†’ì€ 10ê°œ ì¥ë¥´ ì¶”ì¶œ
top5_explicit_genres = explicit_ratio_by_genre.nlargest(10, 'explicit') 

## ğŸŒŸ 11. ìµœìƒìœ„ ì¸ê¸° ì¥ë¥´ ë° ë¼ì´ë¸Œ í¼í¬ë¨¼ìŠ¤ ë¶„ì„
ì „ì²´ ê³¡ ì¤‘ **ìƒìœ„ 0.1%**ì— í•´ë‹¹í•˜ëŠ” 'ì´ˆëŒ€ë°•(Super Hit)' ê³¡ë“¤ì˜ ì¥ë¥´ë¥¼ ë¶„ì„í•˜ê³ , ìŠ¤íŠœë””ì˜¤ ë…¹ìŒë³´ë‹¤ ë¼ì´ë¸Œ(Live) ê³µì—° ë¹„ì¤‘ì´ ë†’ì€ ì¥ë¥´ê°€ ë¬´ì—‡ì¸ì§€ íŒŒì•…í•©ë‹ˆë‹¤.
### 11-1. ìƒìœ„ 0.1% ì¸ê¸°ê³¡ì˜ ì¥ë¥´ ë¶„í¬ (The "Cream of the Crop")
ë‹¨ìˆœ ì¸ê¸° ìˆœìœ„ê°€ ì•„ë‹ˆë¼, ì „ì²´ ë°ì´í„°ì˜ `0.001`(0.1%)ì— í•´ë‹¹í•˜ëŠ” ìµœìƒìœ„ê¶Œ ê³¡ë“¤ë§Œ ì¶”ì¶œí•˜ì—¬ ì–´ë–¤ ì¥ë¥´ê°€ ì‹œì¥ì„ ì§€ë°°í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

# 1. ì¸ê¸°ë„(Popularity) ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
df_sorted = df.sort_values(by='popularity', ascending=False)

# 2. ìƒìœ„ 0.1% (0.001) ë°ì´í„° ì¶”ì¶œ
# ì „ì²´ ë°ì´í„°ê°€ 10ë§Œ ê°œë¼ë©´ ìƒìœ„ 100ê°œë§Œ ë½‘ëŠ” ì…ˆì…ë‹ˆë‹¤.
top_0_1_percent = df_sorted.head(int(0.001 * len(df_sorted)))

# 3. ì¶”ì¶œëœ ìµœìƒìœ„ ê³¡ë“¤ì˜ ì¥ë¥´ë³„ ê°œìˆ˜ ì¹´ìš´íŠ¸
top_genres_count = top_0_1_percent.groupby('track_genre').size().reset_index(name='count')
# 4. ê°€ì¥ ë§ì€ ê³¡ì„ ë°°ì¶œí•œ ì¥ë¥´ ì°¾ê¸° (1ë“± ì¥ë¥´)
most_common_genre = top_genres_count.loc[top_genres_count['count'].idxmax()]

# ê²°ê³¼ í…ìŠ¤íŠ¸ ì¶œë ¥
print(f"The genre with the most songs in the top 0.1% is {most_common_genre['track_genre']} with {most_common_genre['count']} songs.")

# 1. ì¥ë¥´ë³„ í‰ê·  Liveness ì ìˆ˜ ê³„ì‚°
live_ratio_by_genre = df.groupby('track_genre')['liveness'].mean().reset_index()

# 2. Liveness ì ìˆ˜ê°€ ê°€ì¥ ë†’ì€ ìƒìœ„ 10ê°œ ì¥ë¥´ ì¶”ì¶œ
top10_live_genres = live_ratio_by_genre.nlargest(10, 'liveness')

# 3. 1ë“± ì¥ë¥´ ì°¾ê¸°
most_live_genre = live_ratio_by_genre.loc[live_ratio_by_genre['liveness'].idxmax()]
# ê²°ê³¼ í…ìŠ¤íŠ¸ ì¶œë ¥
# .2% í¬ë§·íŒ…ì„ ì‚¬ìš©
## ğŸ”Š 12. ì—ë„ˆì§€(Energy)ì™€ ìŒëŸ‰(Loudness)ì˜ ìƒê´€ê´€ê³„ ë¶„ì„

ìŒì•…ì˜ ë‘ ê°€ì§€ í•µì‹¬ ìš”ì†Œì¸ `Energy`ì™€ `Loudness`ê°€ ì„œë¡œ ì–´ë–¤ ê´€ê³„ì¸ì§€ **íšŒê·€ ë¶„ì„(Regression)**ì„ í†µí•´ í™•ì¸í•˜ê³ , **ì¸ê¸° ì¥ë¥´ Top 3**ëŠ” ì´ ë‘ ê°€ì§€ ìš”ì†Œì—ì„œ ì–´ë–¤ íŠ¹ì§•ì„ ë³´ì´ëŠ”ì§€ ë¹„êµí•©ë‹ˆë‹¤.
### 12-1. ì „ì²´ ë°ì´í„° íšŒê·€ ë¶„ì„ (Regression Plot with Sampling)
ë°ì´í„°ê°€ ë„ˆë¬´ ë§ì„ ë•Œ(ìˆ˜ì‹­ë§Œ ê±´) ëª¨ë“  ì ì„ ì°ìœ¼ë©´ ê·¸ë˜í”„ê°€ ë­‰ê°œì§€ê³  ëŠë ¤ì§‘ë‹ˆë‹¤. ì „ì²´ì˜ **1%ë§Œ ëœë¤ ìƒ˜í”Œë§**í•˜ì—¬ íŠ¸ë Œë“œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ íŒŒì•…í•©ë‹ˆë‹¤.
# 1. ë°ì´í„° ìƒ˜í”Œë§ (ì „ì²´ì˜ 1%ë§Œ ì¶”ì¶œ)
# 10ë§Œ ê±´ ì´ìƒì˜ ë°ì´í„°ì—ì„œ ì‚°ì ë„ë¥¼ ê·¸ë¦´ ë•ŒëŠ” ìƒ˜í”Œë§ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
sample = df.sample(int(0.01 * len(df)))

# 2. íšŒê·€ì„ ì´ í¬í•¨ëœ ì‚°ì ë„ ê·¸ë¦¬ê¸° (Regression Plot)
plt.title("Regression plot of the correlation of energy vs loudness")

# 1. ì¥ë¥´ë³„ í‰ê·  ì¸ê¸° ì ìˆ˜ ê³„ì‚°
avg_popularity_by_genre = df.groupby('track_genre')['popularity'].mean().reset_index()

# 2. ì¸ê¸°ê°€ ê°€ì¥ ë§ì€ ìƒìœ„ 3ê°œ ì¥ë¥´ ì´ë¦„ ì¶”ì¶œ
top3_popular_genres = avg_popularity_by_genre.nlargest(3, 'popularity')

# 3. ì›ë³¸ ë°ì´í„°ì—ì„œ Top 3 ì¥ë¥´ì— í•´ë‹¹í•˜ëŠ” ê³¡ë“¤ë§Œ í•„í„°ë§ (isin í•¨ìˆ˜ í™œìš©)
top3_genre_data = df[df['track_genre'].isin(top3_popular_genres['track_genre'])]
# ë‚´ê°€ ì°¾ê³  ì‹¶ì€ ê°€ìˆ˜ ë¦¬ìŠ¤íŠ¸
favorite_artists = ['Taylor Swift', 'BTS', 'IU']

# 'artists' ì»¬ëŸ¼ì˜ ê°’ì´ ìœ„ ë¦¬ìŠ¤íŠ¸ ì•ˆì— ìˆëŠ” ë°ì´í„°ë§Œ ì¶”ì¶œ
target_songs = df[df['artists'].isin(favorite_artists)]

# 4. ì¥ë¥´ë³„ ì‚°ì ë„ ì‹œê°í™” (Hue = Genrehueë¥¼ ì„¤ì •í•˜ë©´ ê·¸ë˜í”„ ì˜†ì— ì–´ë–¤ ìƒ‰ì´ ì–´ë–¤ ì¥ë¥´ì¸ì§€ ì•Œë ¤ì£¼ëŠ” ì„¤ëª…ì°½(Legend)ì´ ìë™ìœ¼ë¡œ ìƒê¹)

# 1. ì¥ë¥´ë³„ ì¸ê¸° í‰ê·  ê³„ì‚°
# 2. ì¸ê¸°ê°€ 35ì  ì´ìƒì¸ ì¥ë¥´ë§Œ í•„í„°ë§ í›„ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
# (ë§ˆì´ë„ˆí•œ ì¥ë¥´ë¥¼ ì œì™¸í•˜ê³  ì£¼ë¥˜ ì¥ë¥´ ë‚´ì—ì„œì˜ ìˆœìœ„ë¥¼ ë³´ê¸° ìœ„í•¨)
top_genres = top_genres[top_genres >= 35].sort_values(ascending=False)

# 3. Top 10 ì¶œë ¥

## ğŸ¤ 13. ì•„í‹°ìŠ¤íŠ¸ ê°œë³„ ì„±ê³¼ ë¶„ì„ (Data Explode)

ì—¬ëŸ¬ ì•„í‹°ìŠ¤íŠ¸ê°€ í˜‘ì—…(Collaboration)í•œ íŠ¸ë™ì„ ì •í™•í•˜ê²Œ ë¶„ì„í•˜ê¸° ìœ„í•´, ë¬¶ì—¬ ìˆëŠ” ì•„í‹°ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë¶„ë¦¬(`explode`)í•˜ê³ , **í‰ê·  ì¸ê¸° ì ìˆ˜ 70ì  ì´ìƒ**ì¸ 'ìŠˆí¼ìŠ¤íƒ€'ë“¤ì„ ë°œêµ´í•©ë‹ˆë‹¤.

### 13-1. ë°ì´í„° ì¬êµ¬ì¡°í™” (Split & Explode) 
ê°€ì¥ ì¤‘ìš”í•œ ë‹¨ê³„ì…ë‹ˆë‹¤. í•œ ì¤„ì— ë­‰ì³ìˆë˜ ì•„í‹°ìŠ¤íŠ¸ë“¤ì„ ìª¼ê°œì„œ ê°ê°ì˜ í–‰(Row)ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.

# 1. ì›ë³¸ ë°ì´í„° ë³´ì¡´ì„ ìœ„í•´ ë³µì‚¬ë³¸ ìƒì„±
# 2. ë¬¸ìì—´ ë¶„ë¦¬ (String Split)
# ì˜ˆ: "BTS;Coldplay" -> ['BTS', 'Coldplay'] (ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë³€í™˜)
copy_df['artists'] = copy_df['artists'].str.split(';')

# 3. ë°ì´í„° ë‚˜ëˆ„ê¸° (Explode)
# ë¦¬ìŠ¤íŠ¸ ì•ˆì— ìˆëŠ” ìš”ì†Œ ê°œìˆ˜ë§Œí¼ í–‰ì„ ëŠ˜ë¦½ë‹ˆë‹¤.
copy_df = copy_df.explode('artists')

# ê²°ê³¼ í™•ì¸ (ë°ì´í„° ì–‘ì´ ëŠ˜ì–´ë‚¬ëŠ”ì§€ í™•ì¸)
print(f"Original rows: {df.shape[0]}, Exploded rows: {copy_df.shape[0]}")
# 1. ì•„í‹°ìŠ¤íŠ¸ë³„ í‰ê·  ì¸ê¸° ì ìˆ˜ ê³„ì‚°
# 2. ì¸ê¸° ì ìˆ˜ê°€ 70ì  ì´ìƒì¸ ì•„í‹°ìŠ¤íŠ¸ë§Œ í•„í„°ë§ í›„ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
top_artists = top_artists[top_artists >= 70].sort_values(ascending=False)
# 3. Top 10 í™•ì¸
# 4. ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„ë§Œ ë¦¬ìŠ¤íŠ¸ë¡œ ì¶”ì¶œ (ë‚˜ì¤‘ì— í•„í„°ë§ìš©ìœ¼ë¡œ ì‚¬ìš©)
top_artists_list = top_artists.index.tolist()

# 1. Top Artist ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ëœ ê°€ìˆ˜ê°€ ë¶€ë¥¸ ë…¸ë˜ë§Œ ì›ë³¸ì—ì„œ ì°¾ê¸°
# ì£¼ì˜: ì›ë³¸ dfì—ì„œ ê²€ìƒ‰í•˜ë¯€ë¡œ, ë‹¨ë… ëª…ì˜ë¡œ ëœ íŠ¸ë™ ìœ„ì£¼ë¡œ ê²€ìƒ‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
genres_artists = df[df['artists'].isin(top_artists_list)]['track_genre'].unique().tolist()

# 2. ì£¼ìš” ì¥ë¥´ 10ê°œ ì¶œë ¥
# ë²¤ ë‹¤ì´ì–´ê·¸ë¨(Venn Diagram) ì‹œê°í™” ë„êµ¬ ì„¤ì¹˜
!pip install matplotlib_venn
## âš–ï¸ 14. ì¥ë¥´ì™€ ì•„í‹°ìŠ¤íŠ¸ì˜ ìƒê´€ê´€ê³„ ë¶„ì„ (Venn Diagram & Set Analysis)
"ì¸ê¸° ìˆëŠ” ì¥ë¥´(Top Genres)"ì™€ "ì¸ê¸° ê°€ìˆ˜ê°€ í™œë™í•˜ëŠ” ì¥ë¥´(Genres of Top Artists)"ëŠ” ê³¼ì—° ì¼ì¹˜í• ê¹Œìš”?
ë‘ ì§‘í•©ì˜ êµì§‘í•©ê³¼ ì°¨ì§‘í•©ì„ ë¶„ì„í•˜ì—¬ **ì‹œì¥ íŠ¸ë Œë“œ**ì™€ **ì•„í‹°ìŠ¤íŠ¸ ì˜í–¥ë ¥**ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.

### 14-1. ë²¤ ë‹¤ì´ì–´ê·¸ë¨ ì‹œê°í™” (Overlap Visualization)
ë‘ ê·¸ë£¹ ê°„ì˜ í¬í•¨ ê´€ê³„ë¥¼ `venn2` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.

from matplotlib_venn import venn2

# 1. Top Genresë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ì§‘í•© ì—°ì‚°ì„ ìœ„í•´)
# top_genresëŠ” ì´ì „ ë‹¨ê³„ì—ì„œ ì¸ê¸°ë„ 35 ì´ìƒì¸ ì¥ë¥´ë“¤ì…ë‹ˆë‹¤.
top_genres_list = top_genres.index.tolist()

# 2. ë²¤ ë‹¤ì´ì–´ê·¸ë¨ ê·¸ë¦¬ê¸°
# 1. ì§‘í•© ì—°ì‚° ìˆ˜í–‰
# A - B: ì¸ê¸° ì¥ë¥´ì§€ë§Œ ìŠˆí¼ìŠ¤íƒ€ëŠ” ì—†ëŠ” ê³³
top_genres_only = list(set(top_genres_list) - set(genres_artists))

# B - A: ìŠˆí¼ìŠ¤íƒ€ê°€ ë¶€ë¥´ì§€ë§Œ ì¥ë¥´ ì „ì²´ ì¸ê¸°ëŠ” 35 ë¯¸ë§Œì¸ ê³³
genres_artists_only = list(set(genres_artists) - set(top_genres_list))

# A & B: ë‘˜ ë‹¤ í•´ë‹¹í•˜ëŠ” ê³³ (êµì§‘í•©)
intersection = list(set(top_genres_list) & set(genres_artists))

# 2. ê° ê·¸ë£¹ë³„ í‰ê·  ì¸ê¸° ì ìˆ˜ ê³„ì‚° ë° ìƒìœ„ 15ê°œ ì¶”ì¶œ
# ë°ì´í„°í”„ë ˆì„ì—ì„œ í•´ë‹¹ ì¥ë¥´ë“¤ë§Œ ë½‘ì•„ì„œ(isin) í‰ê·  ì¸ê¸°ë„ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•©ë‹ˆë‹¤.

# 1. Top Genres Only
 ax=axes[0], ì²«ë²ˆì§¸ì¹¸ì—

# 2. Genres of Top Artists Only 

# 3. Intersection 

## ğŸŒˆ 15. ì•„í‹°ìŠ¤íŠ¸ì˜ ì¥ë¥´ ë‹¤ì–‘ì„± ë¶„ì„ (Versatility Analysis)

ì•„í‹°ìŠ¤íŠ¸ê°€ ì†Œí™”í•˜ëŠ” **ì¥ë¥´ì˜ ê°œìˆ˜(Genre Count)**ë¥¼ ë¶„ì„í•˜ì—¬, ëŒ€ì¤‘ì ìœ¼ë¡œ ì„±ê³µí•œ ê°€ìˆ˜(Top Artists)ë“¤ì€ ë³´í†µ ëª‡ ê°œì˜ ì¥ë¥´ë¥¼ ë‹¤ë£¨ëŠ”ì§€ ë¶„í¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

ë˜í•œ, ì•„í‹°ìŠ¤íŠ¸ë¥¼ **'ë‹¤ì–‘í•œ ì¥ë¥´ë¥¼ ì‹œë„í•˜ëŠ” ê·¸ë£¹(4ê°œ ì´ìƒ)'**ê³¼ **'í•œ ìš°ë¬¼ë§Œ íŒŒëŠ” ê·¸ë£¹(4ê°œ ë¯¸ë§Œ)'**ìœ¼ë¡œ ë‚˜ëˆ„ì–´, ë‹¤ì–‘ì„±ì´ ì¸ê¸°ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¹„êµí•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.

### 15-1. ì¥ë¥´ ë‹¤ì–‘ì„± ë¶„í¬ ì‹œê°í™” (Genre Count Distribution)
ì „ì²´ ì•„í‹°ìŠ¤íŠ¸ì™€ ì¸ê¸° ì•„í‹°ìŠ¤íŠ¸(í‰ì  60ì  ì´ìƒ)ì˜ ì¥ë¥´ ê°œìˆ˜ ë¶„í¬ë¥¼ íˆìŠ¤í† ê·¸ë¨ìœ¼ë¡œ ë¹„êµí•©ë‹ˆë‹¤.

# 1. ë°ì´í„° ì¤€ë¹„ (Explode)
# ì•„í‹°ìŠ¤íŠ¸ê°€ ì„¸ë¯¸ì½œë¡ (;)ìœ¼ë¡œ ë¬¶ì—¬ìˆëŠ” ê²½ìš°ë¥¼ ë‹¤ í’€ì–´í—¤ì¹©ë‹ˆë‹¤.
copy_df['artists'] = copy_df['artists'].str.split(';')
copy_df = copy_df.explode('artists')

# 2. ì•„í‹°ìŠ¤íŠ¸ë³„ ì†Œí™”í•˜ëŠ” ì¥ë¥´ ê°œìˆ˜ ì¹´ìš´íŠ¸ (All Artists)
artist_genre_count = copy_df.groupby('artists')['track_genre'].nunique().sort_values(ascending=False)

# 3. ì¸ê¸° ì•„í‹°ìŠ¤íŠ¸(Top Artists) í•„í„°ë§
# í‰ê·  ì¸ê¸°ê°€ 60ì  ì´ìƒì¸ 'ì„±ê³µí•œ ì•„í‹°ìŠ¤íŠ¸'ë§Œ ì¶”ì¶œ
top_artists_list = top_artists_scores[top_artists_scores >= 60].sort_values(ascending=False).index.tolist()

# 4. ì¸ê¸° ì•„í‹°ìŠ¤íŠ¸ë“¤ì˜ ì¥ë¥´ ê°œìˆ˜ ì¹´ìš´íŠ¸ (Top Artists Only)
# ìœ„ì—ì„œ ë½‘ì€ ë¦¬ìŠ¤íŠ¸ì— í•´ë‹¹í•˜ëŠ” ê°€ìˆ˜ë“¤ë§Œ ë‚¨ê²¨ì„œ ë‹¤ì‹œ ì…‰ë‹ˆë‹¤.
top_artist_df = copy_df[copy_df['artists'].isin(top_artists_list)]
top_artist_genre_count = top_artist_df.groupby('artists')['track_genre'].nunique().sort_values(ascending=False)

# --- ì‹œê°í™” (Visualization) ---
# ì™¼ìª½ ê·¸ë˜í”„: ì „ì²´ ì•„í‹°ìŠ¤íŠ¸ ë¶„í¬
.set_xticks(np.arange(0, 21, 1)) # Xì¶• ëˆˆê¸ˆ 1ë‹¨ìœ„ë¡œ ì„¤ì •

# ì˜¤ë¥¸ìª½ ê·¸ë˜í”„: Top ì•„í‹°ìŠ¤íŠ¸ ë¶„í¬
axes[1].bar_label(axes[1].containers[0], padding=3)
bar_label(axes[0].containers[0])**ì´ë¼ê³  ì“°ë©´, "ì²« ë²ˆì§¸ ì¹¸ì— ìˆëŠ” ë§‰ëŒ€ê¸°ë“¤ì— ê°ê° ìˆ«ì ë¼ë²¨ì„ ë¶™ì—¬ì¤˜"ë¼ëŠ” ëœ»ì´ ë©ë‹ˆë‹¤.

2. padding=3
**"ë§‰ëŒ€ ëê³¼ ìˆ«ì ì‚¬ì´ì˜ ê°„ê²©"**ì„ ì¡°ì ˆ

# ê¸°ì¤€ê°’ ì„¤ì •: ì¥ë¥´ 4ê°œ

# 1. ë‹¤ì–‘í•œ ì¥ë¥´(>=4) ê·¸ë£¹
artist_more_than_4_genres = artist_genre_count[artist_genre_count >= 4].index.tolist()
df_more_than_4_genres = copy_df[copy_df['artists'].isin(artist_more_than_4_genres)]
diverse_artists_popularity = df_more_than_4_genres.groupby('artists')['popularity'].mean()

# 2. ì†Œìˆ˜ì˜ ì¥ë¥´(<4) ê·¸ë£¹
artist_less_than_4_genres = artist_genre_count[artist_genre_count < 4].index.tolist()
df_less_than_4_genres = copy_df[copy_df['artists'].isin(artist_less_than_4_genres)]

## ğŸ“Š 16. ë‹¤ì–‘ì„± ë¶„ì„ ì‹œê°í™” ë° ìµœì¢… ë°ì´í„° ì •ì œ

ì•„í‹°ìŠ¤íŠ¸ì˜ ì¥ë¥´ ë‹¤ì–‘ì„±(Versatility)ì´ ì¸ê¸°ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì‹œê°í™”í•˜ì—¬ ê²°ë¡ ì„ ë‚´ë¦¬ê³ , ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì— ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ê³¼ ì¤‘ë³µ ë°ì´í„°ë¥¼ ì œê±°í•˜ì—¬ ë°ì´í„°ì…‹ì„ ì™„ì„±í•©ë‹ˆë‹¤.

### 16-1. ë‹¤ì–‘ì„± ê·¸ë£¹ ê°„ ì¸ê¸° ë¹„êµ (Visualization)
**"ì¥ë¥´ë¥¼ ë§ì´ ê±´ë“œë¦¬ëŠ” ê°€ìˆ˜(Generalist)"**ì™€ **"ì ê²Œ ê±´ë“œë¦¬ëŠ” ê°€ìˆ˜(Specialist)"**ì˜ ì¸ê¸° ë¶„í¬ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.


# 1. ì‹œê°í™” ìŠ¤íƒ€ì¼ ì„¤ì •

# --- Top Row: ì¸ê¸° ì ìˆ˜ ë¶„í¬ (Histogram) ---
# ì™¼ìª½: ë‹¤ì–‘í•œ ì¥ë¥´ ê°€ìˆ˜ (Diverse)

# ì˜¤ë¥¸ìª½: ì†Œìˆ˜ ì¥ë¥´ ê°€ìˆ˜ (Less Diverse)

# --- Bottom Row: ê·¸ë£¹ë³„ Top 15 ì•„í‹°ìŠ¤íŠ¸ (Bar Plot) ---
# ì™¼ìª½: ë‹¤ì–‘í•œ ì¥ë¥´ ê·¸ë£¹ì˜ Top 15
sns.barplot(x=diverse_artists.sort_values(ascending=False).head(15).values, 
            y=diverse_artists.sort_values(ascending=False).head(15).index, 
            ax=axes[1, 0], palette='Blues_r')

# ì˜¤ë¥¸ìª½: ì†Œìˆ˜ ì¥ë¥´ ê·¸ë£¹ì˜ Top 15
sns.barplot(x=less_diverse_artists.sort_values(ascending=False).head(15).values, 
            y=less_diverse_artists.sort_values(ascending=False).head(15).index, 
            ax=axes[1, 1], palette='Reds_r')

# 'time_signature'(ë°•ì)ì™€ 'key'(ì¡°ì„±) ì»¬ëŸ¼ ì œê±°
# ì´ìœ : 
# 1. Time SignatureëŠ” ëŒ€ì¤‘ê°€ìš”ì˜ 90% ì´ìƒì´ 4/4ë°•ìë¼ ë³€ë³„ë ¥ì´ ë‚®ìŒ.
# 2. KeyëŠ” ìˆ«ì(0~11)ë¡œ ë˜ì–´ìˆì§€ë§Œ ì‹¤ì œë¡  ë²”ì£¼í˜•ì´ë¼, ì›-í•« ì¸ì½”ë”© ì—†ì´ ì“°ë©´ ëª¨ë¸ì´ ì˜¤í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# track_idê°€ ì¤‘ë³µëœ í–‰ì„ ì œê±° (í•˜ë‚˜ë§Œ ë‚¨ê¹€)
df.drop_duplicates(subset=['track_id'], inplace=True)

# ìµœì¢… ë°ì´í„° í™•ì¸

## ğŸ¤– 17. ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ì¶”ì²œ ì‹œìŠ¤í…œ êµ¬í˜„ (Recommendation Engine)

ì‚¬ìš©ìê°€ ì„ íƒí•œ ë…¸ë˜ì™€ ì˜¤ë””ì˜¤ íŠ¹ì„±(Audio Features)ì´ ê°€ì¥ ìœ ì‚¬í•œ ê³¡ì„ ì°¾ì•„ì£¼ëŠ” ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### 17-1. ë°ì´í„° ì •ê·œí™” (Min-Max Scaling)
ì¶”ì²œ ì‹œìŠ¤í…œì˜ ê³µì •ì„±ì„ ìœ„í•´ ëª¨ë“  ë°ì´í„°ì˜ ë²”ìœ„ë¥¼ **0ê³¼ 1 ì‚¬ì´**ë¡œ ë§ì¶¥ë‹ˆë‹¤.
* *ì´ìœ :* `Loudness`(-60)ì™€ `Energy`(0.8)ëŠ” ë‹¨ìœ„ê°€ ë‹¤ë¦…ë‹ˆë‹¤. ì •ê·œí™”ë¥¼ ì•ˆ í•˜ë©´ ìˆ«ìê°€ í° `Loudness`ê°€ ì¶”ì²œ ê²°ê³¼ë¥¼ ë…ì í•˜ê²Œ ë©ë‹ˆë‹¤.

# 1. ì •ê·œí™” ë„êµ¬(Scaler) ìƒì„±
scaler = preprocessing.MinMaxScaler()

# 2. ìˆ˜ì¹˜í˜• ë°ì´í„°ë§Œ ì„ íƒ
numerical_cols = df.select_dtypes(include=np.number).columns

# 3. ì •ê·œí™” ìˆ˜í–‰ ë° ë°ì´í„°í”„ë ˆì„ ë³€í™˜
# ì¸ë±ìŠ¤ë¥¼ 'track_id'ë¡œ ì„¤ì •í•˜ì—¬ ë‚˜ì¤‘ì— ë…¸ë˜ë¥¼ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆê²Œ í•¨
data_norm = pd.DataFrame(scaler.fit_transform(df[numerical_cols]), 
                         columns=numerical_cols, 
                         index=df['track_id'])

# ì •ê·œí™”ëœ ë°ì´í„° í™•ì¸
display(data_norm.head())

# ì¶”ì²œ ê¸°ì¤€ì´ ë  ë…¸ë˜ ì œëª© ì„¤ì •
# (ì´ ë³€ìˆ˜ë§Œ ë°”ê¾¸ë©´ ë‹¤ë¥¸ ë…¸ë˜ì— ëŒ€í•œ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!)
trackNameListened = "Knockin' On Heaven's Door"

# 1. í•´ë‹¹ ë…¸ë˜ì˜ ê³ ìœ  ID(track_id) ì°¾ê¸°
# ë°ì´í„°í”„ë ˆì„ì—ì„œ ì œëª©ìœ¼ë¡œ ê²€ìƒ‰ í›„ ì²« ë²ˆì§¸ ê²°ê³¼ì˜ ID ì¶”ì¶œ
track_id = df[(df['track_name'] == trackNameListened)][['track_id']].values[0][0]

# 2. í•´ë‹¹ ë…¸ë˜ì˜ ì •ê·œí™”ëœ ì˜¤ë””ì˜¤ íŠ¹ì„±ê°’(Vector) ì¶”ì¶œ
target_track = list(data_norm.loc[track_id])

print(f"Feature Vector (First 5): {target_track[:5]}...")

from scipy.spatial import distance

data_result = pd.DataFrame()

# 1. ëª¨ë“  ë…¸ë˜ì™€ì˜ ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³„ì‚° (List Comprehension)
# data_normì˜ ëª¨ë“  í–‰(obj)ì„ ìˆœíšŒí•˜ë©° target_trackê³¼ì˜ ê±°ë¦¬ë¥¼ ì°ë‹¤.
data_result['euclidean'] = [distance.euclidean(obj, target_track) for index, obj in data_norm.iterrows()]

# 2. ID ë§¤í•‘
data_result['track_id'] = data_norm.index

# ê²°ê³¼ í™•ì¸ (ê±°ë¦¬ê°€ ê³„ì‚°ëœ ìƒíƒœ)
# ê±°ë¦¬ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ (ê°€ê¹Œìš´ ìˆœ) í›„ ìƒìœ„ 6ê°œ ì¶”ì¶œ
data_rec = data_result.sort_values(by=['euclidean']).iloc[:6]

# ì¶”ì²œ ê²°ê³¼ ID í™•ì¸
## ğŸ 18. ìµœì¢… ì¶”ì²œ ê²°ê³¼ ë³€í™˜ ë° ì¶œë ¥ (Final Result Display)

ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì´ ê³„ì‚°í•œ 'Track ID'ë¥¼ ì‚¬ìš©í•˜ì—¬, ì›ë³¸ ë°ì´í„°ì—ì„œ ì‹¤ì œ **ë…¸ë˜ ì œëª©(Track Name)**ê³¼ **ì•„í‹°ìŠ¤íŠ¸(Artist)** ì •ë³´ë¥¼ ì°¾ì•„ì™€ ì‚¬ìš©ìì—ê²Œ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

### 18-1. ID ë§¤í•‘ ë° ì •ë³´ ì¶”ì¶œ (ID Lookup)
`track_id`ë¥¼ ì¸ë±ìŠ¤ë¡œ ì„¤ì •í•˜ì—¬ ê²€ìƒ‰ ì†ë„ë¥¼ ë†’ì´ê³ , ì¶”ì²œëœ IDë“¤ì— í•´ë‹¹í•˜ëŠ” ì •ë³´ë¥¼ ìˆœì„œëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

# 1. ê²€ìƒ‰ìš© ë°ì´í„°í”„ë ˆì„ ìƒì„± (ì¸ë±ìŠ¤ë¥¼ track_idë¡œ ì„¤ì •)
# ì´ë ‡ê²Œ í•˜ë©´ IDë¡œ ë°”ë¡œ ë…¸ë˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ìˆì–´ í¸ë¦¬í•©ë‹ˆë‹¤.
data_init = df.set_index('track_id')

# 2. ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ ì •ë³´ ìˆ˜ì§‘
track_list = pd.DataFrame()

# data_recì— ìˆëŠ” ìƒìœ„ 6ê°œ íŠ¸ë™ IDë¥¼ í•˜ë‚˜ì”© êº¼ë‚´ì„œ ë°˜ë³µ
for i in list(data_rec['track_id']):
    # ì›ë³¸ ë°ì´í„°ì— í•´ë‹¹ IDê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    if i in data_init.index:
        # ì œëª©ê³¼ ê°€ìˆ˜ ì •ë³´ ì¶”ì¶œ
        track_info = data_init.loc[[i], ['track_name', 'artists']]
        # ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (pd.concat ì‚¬ìš©)
        track_list = pd.concat([track_list, track_info], ignore_index=True)

# 3. ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë³€í™˜ (ì¶œë ¥í•˜ê¸° ì‰½ê²Œ)
recomended = track_list.values.tolist()

print
You've just listened:  
 \t - {recomended[0][0]} by {recomended[0][1]} 
